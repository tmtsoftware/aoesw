```plantuml

!pragma teoz true
!include_many participants.puml
!includesub common.puml!variables
hide unlinked

' TODO fix up OCS interaction

ocs -> aosq ++: ExerciseTheRTCWithNCPAAndSimulatedTurbulence
alt LGS
!includesub common.puml!ActivateLGS
aosq -> trombone ++: move
note left: Set LGS trombone to ??
return Completed
else NGS
!includesub common.puml!ActivateNGS
end

!includesub common.puml!NSCUBB
aosq -> ssNgs ++: deploy
note left: Deploy FPM
return Completed
aosq -> pwfs ++: startContinuousExposures
note left: Enable PWFS continuous exposures
return Completed
aosq -> lgsWfs ++: startContinuousExposures
note left: Enable LGS WFS continuous exposures
return Completed
aosq -> oiwfsDetector ++: exposure
note left: OIWFS in continuous exposure mode
return Completed
aosq -> rtc ++: mode
note left: Setup RTC in LGS or NGS AO mode
return Completed
aosq -> rpg ++: configure
note left: Setup RPG in LGS or NGS AO mode
return Completed
aosq -> rpg ++: prepareRTC
note left: RPG to load LGS WFS and PWFS offsets and DM flats and send to RTC
return Completed
aosq -> rpg ++: prepareHighReconstructor
note left: RPG to compete control matrix and send to RTC
return Completed
!includesub common.puml!AcquireLGS
!includesub common.puml!AcquirePWFS
!includesub common.puml!AcquireOIWFS
aosq -> rtc ++: pipelineActivate
note left: RTC to process pixels and close AO loops
loop Repeat with each instrument and selected operation modes
alt Using instrument imager
!includesub common.puml!InstExposure
else Using NSEN
aosq -> nsen: ACQ_expose
note left: take NSEN exposure
return [Exposure Completed]
end
aosq -> rpg ++: calibrateNpca?
note left: RPG to retrieve image and assess image quality
return Completed
aosq -> rpg ++: simulatedTurbulence
note left: RPG and RTC to inject simulated turbulence on DMs
return Completed
group Adjust one or more of the following to vary simulated telescope zenith angle from 0 to 60 degrees
aosq -> ssLgs ++: move
note left: Vary calibration LGS source axial location
return Completed
aosq -> irisRotator ++: move
note left: Rotate instrument rotator
return Completed
aosq -> trombone ++: move
note left: Adjust LGS rotator
return Completed
end
aosq -> rpg ++: followRTC
note left: RPG to update RTC parameters
return Completed
end
return Completed
```