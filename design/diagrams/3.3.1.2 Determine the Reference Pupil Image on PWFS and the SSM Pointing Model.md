```plantuml
!pragma teoz true
!include_many participants.puml
!includesub common.puml!variables
hide unlinked 

ocs -> aosq ++: DeterminePwfsRefAndSsmPointing
skinparam sequenceMessageAlign right

!includesub common.puml!NSCUBB
aosq -> pwfs ++: $TBD
note left: Configure PWFS detector params
return Completed
aosq -> pwfs ++: setBinning
note left: Configure PWFS detector to no binning
return Completed
aosq -> vnwFsm ++: follow
note left: Set VNW FSM to follow at maximum modulation
return Completed
aosq -> rtc ++: mode
note left: Configure RTC in NGSAO mode
return Completed
aosq -> rtc ++: $TBD
note left: Configure RTC with 0 gain for TTS and DM control
return Completed
aosq -> rtc ++: zeroPwfs
note left: Configure SSM in Cal mode
return Completed
aosq -> ssNgs ++: deploy
note left: Deploy NFIRAOS pinhole mask
return Completed
aosq -> vnwSsm ++: move
note left: Move SSM to center pinhole
return Completed
aosq -> pwfs ++: startContinuousExposures
note left: Enable PWFS continuous exposures
return Completed
aosq -> rtc ++: offloadPwfsSsm 
note left: Command RTC to close TTF control loop
return Completed

loop For all SSM pinhole locations
alt For center pinhole location
aosq -> vnwSsm ++: nudgePwfs
note left: Calibrate the SSM
return Completed
else Other SSM locations
aosq -> rtc ++: algoSetPwfs(?) 
note left: Compute pupil centering error (TBC)
return Completed
end

aosq -> pwfs ++: stop
note left: Stop when within tolerance
return Completed
aosq -> rtc ++: loopOpen?
note left: Open loops when stopped (DO THIS?)
return Completed
aosq -> vnwSsm ++: nudgePwfs?
note left: Move the SSM to another pinhole
return Completed
end
aosq -> vnwSsm ++: $TBD
note left: Determine pointing model
return Completed

return Completed

```