```plantuml
!pragma teoz true
!include_many participants.puml
!includesub common.puml!variables
hide unlinked 

ocs -> aosq ++: CalibrateNcpa
!includesub common.puml!ActivateLGS
!includesub common.puml!ActivateNGS
aosq -> trombone ++: move
note left: Set LGS trombone to zenith
return Completed
!includesub common.puml!NSCUBB
aosq -> ssNgs ++: deploy
note left: Deploy FPM
return Completed
aosq -> rtc ++: mode
note left: Setup RTC in LGS AO mode
return Completed
aosq -> pwfs ++: startContinuousExposures
note left: Enable PWFS continuous exposures
return Completed
aosq -> lgsWfs ++: startContinuousExposures
note left: Enable LGS WFS continuous exposures
return Completed
aosq -> oiwfsDetector ++: exposure 
note left: OIWFS in continuous exposure mode
return Completed

loop Repeat with different NFIRAOS/instrument mode and zenith angles 

$slew("Move telescope to specified zenith angle")

loop Repeat with different instrument rotator angles
aosq -> trombone ++: move
note left: Acquire cal source on LGS
return Completed

aosq -> vnwSsm ++: move
note left: Acquire cal source on PWFS
return Completed
aosq -> oiwfsPoa ++: POS_move
note left: Acquire cal source on OIWFS
return Completed


loop Repeat until RPG converges
aosq -> rtc ++: loopHigh
note left: RTC to close HO AO loop
return Completed
aosq -> rtc ++: $TBD
note left: RTC to listen to RPG for WFS gradient ref and apply
return Completed

!includesub common.puml!ImagerExposure

group For Phase Diversity algorithm
aosq -> rpg ++: calibrateNcpa
note left: RPG to apply focus offset
return Completed

!includesub common.puml!ImagerExposure

aosq -> rpg ++: calibrateNcpa
note left: RPG to remove offset
return Completed
end

aosq -> rpg ++: calibrateNcpa
note left: RPG to update LGS WFS ref vector using science image from DMS
return Completed
aosq -> rpg ++: calibrateNcpa
note left: RPG to check science image quality
return Completed
end

aosq -> pwfs ++: startContinuousExposures
note left: Enable PWFS continuous exposures
return Completed

aosq -> oiwfsDetector ++: exposure 
note left: OIWFS to take multiple successive exposures
return Completed

aosq -> rtc ++: $TBD
note left: RTC to send gradients to RPG
return Completed
aosq -> rtc ++: $TBD
note left: RTC to set DM Integrator output to RPG
return Completed

aosq -> rotator ++: move
note left: Adjust instrument rotator angle
return Completed
end

aosq -> rpg ++: $TBD
note left: RPG to store NCPA info in database
return Completed
end

return Completed
```