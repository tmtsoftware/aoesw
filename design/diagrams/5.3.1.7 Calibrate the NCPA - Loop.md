```plantuml
!pragma teoz true
!include_many participants.puml
!includesub common.puml!variables
hide unlinked 

loop Repeat with different NFIRAOS/instrument modes and zenith angles 

loop Repeat with different instrument rotator angles
aosq -> trombone ++: move
note left: Acquire cal source on LGS
return Completed

aosq -> vnwSsm ++: move
note left: Acquire cal source on PWFS
return Completed
aosq -> oiwfsPoa ++: POS_move
note left: Acquire cal source on OIWFS
return Completed

loop Repeat until RPG converges
aosq -> rtc ++: loopHigh
note left: RTC to close HO AO loop
return Completed
aosq -> rtc ++: $TBD
note left: RTC to listen to RPG for WFS gradient ref and apply
return Completed

!includesub common.puml!ImagerExposure

group For Phase Diversity algorithm
aosq -> rpg ++: calibrateNcpa
note left: RPG to apply focus offset
return Completed

!includesub common.puml!ImagerExposure

aosq -> rpg ++: calibrateNcpa
note left: RPG to remove offset
return Completed
end

aosq -> rpg ++: calibrateNcpa
note left: RPG to update LGS WFS ref vector using science image from DMS
return Completed
aosq -> rpg ++: calibrateNcpa
note left: RPG to check science image quality
return Completed
end

aosq -> pwfs ++: startContinuousExposures
note left: Enable PWFS continuous exposures
return Completed

aosq -> oiwfsDetector ++: exposure 
note left: OIWFS to take multiple successive exposures
return Completed

aosq -> rtc ++: $TBD
note left: RTC to send WFS gradients to RPG
return Completed
aosq -> rtc ++: $TBD
note left: RTC to send DM Integrator output to RPG
return Completed

aosq -> rotator ++: move
note left: Adjust instrument rotator angle
return Completed
end

aosq -> rpg ++: $TBD
note left: RPG to store NCPA info in database
return Completed


alt If more zenith angles

aosq -> ssLgs ++: setRangeDistance
note left: Set LGS calibration source to different zenith angle
aosq -> trombone ++: move
note left: Set LGS trombone to matching zenith angle
return Completed
& return
end

end


```