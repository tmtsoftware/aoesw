```plantuml
!pragma teoz true
!include_many participants.puml
!includesub common.puml!variables
hide unlinked


ocs -> aosq ++: AcquireAndLockTTOIWFSOrODFGW
loop For each OIWFS and ODGW used for TT

alt OIWFS
aosq -> oiwfsDetector ++: exposure
note left: Take single exposure
return Completed
aosq -> aosq : Check flux
opt If flux not good
!includesub common.puml!SpiralSearch
end
else ODGW
aosq -> odgw ++: exposure
note left: Take single exposure
return Completed
aosq -> aosq : Check flux
opt If flux not good
?<- aosq: Exit with error
end
end

aosq -> rtc ++: $TBD
note left: Compute gradients
return Completed
aosq -> rtc ++: $TBD
note left: Compute average spot position.\nIf necessary, adjust gradient reference vector 
return Completed
aosq -> rtc ++: loopLowTier2
note left: Close the tip/tilt/focus and plate scale loops\nwith all available low order WFS
return Completed

alt OIWFS
aosq -> oiwfsDetector ++: exposure
note left: Start continous exposures.\nWindow shrinks according to table.
return Completed
else ODGW
aosq -> odgw ++: exposure
note left: Start continous exposures.\nWindow shrinks according to table.
return Completed
end

aosq -> rtc ++: algoSetOiwfsOdgw
note left: Start matched filter update process and\nswitch to matched filter when available.
return Completed
end

return Completed

```