```plantuml
!pragma teoz true
!include_many participants.puml
!includesub common.puml!variables
hide unlinked


ocs -> aosq ++: AcquireAndLockTtOiwfsOrOdgw
group In parallel, for each OIWFS and ODGW used for TT

alt OIWFS
aosq -> oiwfsDetector ++: exposure
note left: Take single exposure
return Completed
alt If star not found
!includesub common.puml!SpiralSearch
end
else ODGW
aosq -> odgw ++: exposure
note left: Take single exposure
return Completed
alt If star not found
?<- aosq: Exit with error
end
end

aosq -> aosq : Check flux
alt If flux not good
aosq -> timing ++: enableTrigger
note left: Adjust integration time
return Completed
alt if ODGW
aosq -> odgw ++: init_acquisition_table
note left: Download new acquisition table\nwith adjusted integration times
return Completed
end
end

aosq -> rtc ++: calibModeGrad
note left: Compute gradients
return Completed
aosq -> rtc ++: $TBD
note left: Compute average spot position.\nIf necessary, adjust gradient reference vector 
return Completed
aosq -> rtc ++: loopLowTier2
note left: Close the tip/tilt/focus and plate scale loops\nwith all available low order WFS
return Completed

alt OIWFS
aosq -> oiwfsDetector ++: exposure
note left: Start continous exposures.\nWindow shrinks according to table.
return Completed
else ODGW
aosq -> odgw ++: exposure
note left: Start continous exposures.\nWindow shrinks according to table.
return Completed
end

end
return Completed

```