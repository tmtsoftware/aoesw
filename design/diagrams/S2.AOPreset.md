```plantuml
!pragma teoz true
!include_many participants.puml
!includesub common.puml!variables
hide unlinked

ocs -> aosq ++: prepare for preset
aosq -> ism ++: select(port, yoffset, xOffset)
note left: offset ISM away from instrument
return offset complete
return ready for preset

ocs -> aosq ++: preset
group In parallel
  group NFIRAOS
    aosq -> nscu ++: shutterOpen
    note left: +Open NSCU entrance shutter
    aosq -> bs ++: select(SCIENCE)
    note left: Select the science beam splitter
    aosq -> ngsAdc ++: follow
    note left: Enable NGS ADC Follow mode 
    aosq -> ngsSsm ++: follow
    note left: Enable NGS SSM Follow mode 
    aosq -> ssNgs ++: source(?)
    note left: +Turn off NGS Source Simulator
    aosq -> ssNgs ++: deploy(?)
    note left: +Extract NGS Source Simulator
    aosq -> timing ++: enableTrigger
    note left: Configure and start the timing generator
    aosq -> pwfs ++: setBinning
    note left: Configure VCAM
    return Completed
    aosq -> pwfs ++: startTriggeredExposures
    note left: Start VCAM continuous exposures
    aosq -> lgsWfs ++: startTriggeredExposures
    note left: +Start LGS VCAM
    aosq -> trombone ++: follow/park
    note left: +Configure trombone (NGS:park, LGS: follow)
    group If NSEN is used
    aosq -> nsen ++: BENCH_select_sensor
    note left: +Activate NSEN Acq mechanism
    return Completed
    aosq -> nsen ++: BENCH_move_sensor
    note left: +Move NSEN Acq mechanism
    return Completed
    aosq -> nsen ++: ACQ_config_exposure
    note left: +Configure NSEN Acq camera
    return Completed
    end
    aosq -> rtc ++: mode
    note left: Set the AO mode for RTC
    return Completed
    aosq -> rtc ++: pipelineActivate
    note left: +Start RTC pipeline
    return Completed
    & return
    & return
    & return
    & return
    & return
    & return
    & return
    & return
    & return
  end
  group LGSF
    aosq -> lgsf ++: setState(ON)
    note left: Set LGSF to ON state
    return Completed
  end
  group OIWFS, for each probe used
    aosq -> oiwfsPoa ++: MODE_select(TT|TTF|OFF)
    note left: Configure OIWFS for TT, TTF, or not used
    return Completed
    aosq -> oiwfsPoa ++: POS_follow
    note left: Set POA to follow mode
    aosq -> oiwfsAdc ++: follow
    note left: Set ADC to follow mode
    aosq -> rotator ++: follow
    note left: -Set instrument rotator to follow mode
    aosq -> oiwfsDetector ++: init_acquisition_table
    note left: +Initialize subwindow stepping sequence table for each ODGW
    return Completed
    & return
    & return
    & return
    aosq -> oiwfsDetector ++: exposure(CONTINUOUS)
    note left: Enable continuous readout mode
    return Completed
  end
  group IRIS ODGW (if used)
    aosq -> odgw ++: init_acquisition_table
    note left: Initialize subwindow stepping sequence table for each ODGW
    return Completed
    aosq -> odgw ++: exposure(CONTINUOUS)
    note left: Enable continuous readout mode
    return Completed
  end
  group RPG
    aosq -> rpg ++: configure
    note left: ï‚§	Obtain Cn2 profile, sky transparency, etc. from SCMS
    return Completed
    aosq -> rpg ++: prepareRTC
    note left: Send reconstruction parameters to RTC
    return Completed
    aosq -> rpg ++: listen
    note left: Start to listen for new data from RTC
    return Completed
  end
end

aosq -> ism ++: select(port)
note left: point ISM to instrument
return move complete
return preset complete

```