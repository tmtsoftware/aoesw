```plantuml
!pragma teoz true
participant "ESW\nOCS\n//ESW.ocs//" as ocs
participant "AOESW\nAO Sequencer\n//AOESW.aosq//" as aosq
participant "NFIRAOS\nISM\n//NFIRAOS.ism//" as ism
participant "NFIRAOS\nTiming\n//NFIRAOS.timing//" as timing
participant "NFIRAOS\nRTC\n//NFIRAOS.rtc//" as rtc
participant "NFIRAOS\nPWFS\n//NFIRAOS.pwfs//" as pwfs
participant "NFIRAOS\nNGS SSM\n//NFIRAOS.ngsSsm//" as ngsSsm
participant "NFIRAOS\nNGS ADC\n//NFIRAOS.ngsAdc//" as ngsAdc
participant "NFIRAOS\nBeam Splitter\n//NFIRAOS.bs//" as bs
participant "NFIRAOS\nNSEN\n//NFIRAOS.nsen//" as nsen
participant "NFIRAOS\nLGS WFS\n//NFIRAOS.lfsWfs//" as lgsWfs
participant "LGSF\nLGSF Sequencer\n//LGSF.sq//" as lgsf
participant "IRIS\nOIWFS<n> Detector\n//IRIS.oiwfs<n>.detector//" as oiwfsDetector
participant "IRIS\nIns Rotator\n//IRIS.rotator//" as rotator
participant "IRIS\nOIWFS<n> ADC\n//IRIS.oiwfs<n>.adc//" as oiwfsAdc
participant "IRIS\nOIWFS<n> POA\n//IRIS.oiwfs<n>.poa//" as oiwfsPoa
participant "IRIS\nODGW\n//IRIS.imager.odgw//" as odgw
participant "AOESW\nRPG\n//AOESW.rpg//" as rpg

ocs -> aosq ++: prepare for preset
aosq -> ism ++: select(port, yoffset, xOffset)
note left: offset ISM away from instrument
return offset complete
return ready for preset


ocs -> aosq ++: preset

group In parallel
  group NFIRAOS
    aosq -> bs ++: select(SCIENCE)
    note left: Select the science beam splitter
    aosq -> ngsAdc ++: follow
    note left: Enable NGS ADC Follow mode 
    aosq -> ngsSsm ++: follow
    note left: Enable NGS SSM Follow mode 
    aosq -> pwfs ++: setPixelStream? setRtcDestinations? setRtcTargets?
    note left: Configure VCAM
    aosq -> rtc ++: mode?
    note left: Set the AO mode for RTC
    aosq -> timing ++: enableTrigger
    note left: Configure and start the timing generator
    return Completed
    & return
    & return
    & return
    & return
    & return
  end
  group LGSF
    aosq -> lgsf ++: setState(READY)
    note left: Set LGSF to READY state
    return Completed
  end
  group OIWFS, for each probe used
    aosq -> oiwfsPoa ++: MODE_select(TT|TTF|OFF)
    note left: Configure OIWFS for TT, TTF, or not used
    aosq -> oiwfsAdc ++: follow
    note left: Set ADC to follow mode
    aosq -> oiwfsPoa: POS_follow
    note left: Set POA to follow mode
    aosq -> rotator ++: follow
    note left: Set instrument rotator to follow mode
    aosq -> oiwfsDetector ++: exposure(CONTINUOUS)
    note left: Enable continuous readout mode
    return Completed
    & return
    & return
    & return
  end
  group IRIS ODGW (if used)
    aosq -> odgw ++: init_acquisition_table
    note left: Initialize subwindow stepping sequence table for each ODGW
    return Completed
    aosq -> odgw ++: exposure(CONTINUOUS)
    note left: Enable continuous readout mode
    return Completed
  end
  group RPG
    aosq -> rpg ++: start reconstruction
    note left: Send reconstruction parameters to RTC
    return Completed
    aosq -> rpg ++: listen
    note left: Start to listen for new data from RTC
    return Completed
  end
end

aosq -> ism ++: select(port)
note left: point ISM to instrument
return move complete
return preset complete

```